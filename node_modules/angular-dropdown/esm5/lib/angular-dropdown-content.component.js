/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { Component, Input, Host, Inject, forwardRef, NgZone } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { AngularDropdownDirective } from './angular-dropdown.directive';
import { closest, waitForAnimation } from './utils';
/** @type {?} */
var MutationObserver = ((/** @type {?} */ (window))).MutationObserver;
var AngularDropdownContentComponent = /** @class */ (function () {
    function AngularDropdownContentComponent(dropdown, zone, document) {
        var _this = this;
        this.dropdown = dropdown;
        this.zone = zone;
        this.dropdownClass = '';
        this.overlay = false;
        this.hasMoved = false;
        this._animationClass = null;
        this.isTouchDevice = 'ontouchstart' in window;
        this.mutationObserver = null;
        this.destroy$ = new Subject();
        this.transitioningInClass = 'ng-dropdown-content--transitioning-in';
        this.transitionedInClass = 'ng-dropdown-content--transitioned-in';
        this.transitioningOutClass = 'ng-dropdown-content--transitioning-out';
        this.shouldOpen = false;
        this.repositionInZone = function () {
            return _this.zone.run(function () { return _this.dropdown.reposition(); });
        };
        this.handleRootMouseDown = function (e) {
            if (_this.hasMoved ||
                _this.dropdownElement.contains((/** @type {?} */ (e.target))) ||
                (_this.triggerElement &&
                    _this.triggerElement.contains((/** @type {?} */ (e.target))))) {
                _this.hasMoved = false;
                return;
            }
            /** @type {?} */
            var closestDropdown = closest((/** @type {?} */ (e.target)), 'ng-dropdown-content');
            if (closestDropdown) {
                /** @type {?} */
                var trigger = _this.document.querySelector("[aria-controls=" + closestDropdown.getAttribute('id') + "]");
                /** @type {?} */
                var parentDropdown = closest((/** @type {?} */ (trigger)), 'ng-dropdown-content');
                if (parentDropdown &&
                    parentDropdown.getAttribute('id') === _this.dropdown.dropdownId) {
                    _this.hasMoved = false;
                    return;
                }
            }
            _this.dropdown.close(true);
        };
        this.touchStartHandler = function (e) {
            _this.document.body.addEventListener('touchmove', _this.touchMoveHandler, true);
        };
        this.touchMoveHandler = function (e) {
            _this.hasMoved = true;
            _this.document.body.removeEventListener('touchmove', _this.touchMoveHandler, true);
        };
        this.document = document;
    }
    Object.defineProperty(AngularDropdownContentComponent.prototype, "dropdownElement", {
        get: /**
         * @return {?}
         */
        function () {
            return this.dropdown.dropdownElement;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    AngularDropdownContentComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.dropdown.onOpen
            .pipe(takeUntil(this.destroy$))
            .subscribe(function () { return (_this.shouldOpen = true); });
        this.dropdown.onClose
            .pipe(takeUntil(this.destroy$))
            .subscribe(function () { return _this.close(); });
    };
    Object.defineProperty(AngularDropdownContentComponent.prototype, "animationClass", {
        get: /**
         * @return {?}
         */
        function () {
            return this._animationClass;
        },
        set: /**
         * @param {?} className
         * @return {?}
         */
        function (className) {
            if (this._animationClass && className !== this._animationClass) {
                this.dropdownElement.classList.remove(this._animationClass);
            }
            else if (className) {
                this.dropdownElement.classList.add(className);
            }
            this._animationClass = className;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AngularDropdownContentComponent.prototype, "triggerElement", {
        get: /**
         * @return {?}
         */
        function () {
            return this.dropdown.triggerElement;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    AngularDropdownContentComponent.prototype.ngAfterViewChecked = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.shouldOpen) {
            this.animationClass = this.transitioningInClass;
            requestAnimationFrame(function () { return _this.open(); });
            this.shouldOpen = false;
        }
    };
    /**
     * @return {?}
     */
    AngularDropdownContentComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.destroy$.next();
        this.teardownEvents();
    };
    /**
     * @return {?}
     */
    AngularDropdownContentComponent.prototype.open = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.document.body.addEventListener('mousedown', this.handleRootMouseDown, true);
        if (this.isTouchDevice) {
            this.document.body.addEventListener('touchstart', this.touchStartHandler, true);
            this.document.body.addEventListener('touchend', this.handleRootMouseDown, true);
        }
        /** @type {?} */
        var changes = this.dropdown.reposition();
        if (!this.dropdown.renderInPlace) {
            this.addGlobalEvents();
            this.startObservingDomMutations();
        }
        else if (changes !== null && changes.vPosition === 'above') {
            this.startObservingDomMutations();
        }
        requestAnimationFrame(function () { return _this.animateIn(); });
    };
    /**
     * @return {?}
     */
    AngularDropdownContentComponent.prototype.close = /**
     * @return {?}
     */
    function () {
        this.teardownEvents();
        this.animateOut();
    };
    /**
     * @return {?}
     */
    AngularDropdownContentComponent.prototype.animateIn = /**
     * @return {?}
     */
    function () {
        var _this = this;
        waitForAnimation(this.dropdownElement, function () {
            _this.animationClass = _this.transitionedInClass;
        });
    };
    /**
     * @return {?}
     */
    AngularDropdownContentComponent.prototype.animateOut = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var parentElement = this.dropdown.renderInPlace
            ? (/** @type {?} */ (this.dropdownElement.parentElement)).parentElement
            : this.dropdownElement.parentElement;
        /** @type {?} */
        var clone = (/** @type {?} */ (this.dropdownElement.cloneNode(true)));
        clone.id = this.dropdownElement.id + "--clone";
        clone.classList.remove(this.transitionedInClass);
        clone.classList.remove(this.transitioningInClass);
        clone.classList.add(this.transitioningOutClass);
        (/** @type {?} */ (parentElement)).appendChild(clone);
        this.animationClass = this.transitioningInClass;
        waitForAnimation(clone, function () { return (/** @type {?} */ (parentElement)).removeChild(clone); });
    };
    /**
     * @return {?}
     */
    AngularDropdownContentComponent.prototype.startObservingDomMutations = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (MutationObserver) {
            this.mutationObserver = new MutationObserver(function (mutations) {
                if (mutations[0].addedNodes.length ||
                    mutations[0].removedNodes.length) {
                    _this.repositionInZone();
                }
            });
            (/** @type {?} */ (this.mutationObserver)).observe(this.dropdownElement, {
                childList: true,
                subtree: true
            });
        }
        else {
            this.dropdownElement.addEventListener('DOMNodeInserted', this.repositionInZone, false);
            this.dropdownElement.addEventListener('DOMNodeRemoved', this.repositionInZone, false);
        }
    };
    /**
     * @return {?}
     */
    AngularDropdownContentComponent.prototype.stopObservingDomMutations = /**
     * @return {?}
     */
    function () {
        if (MutationObserver) {
            if (this.mutationObserver) {
                this.mutationObserver.disconnect();
                this.mutationObserver = null;
            }
        }
        else {
            if (this.dropdownElement) {
                this.dropdownElement.removeEventListener('DOMNodeInserted', this.repositionInZone);
                this.dropdownElement.removeEventListener('DOMNodeRemoved', this.repositionInZone);
            }
        }
    };
    /**
     * @return {?}
     */
    AngularDropdownContentComponent.prototype.addGlobalEvents = /**
     * @return {?}
     */
    function () {
        window.addEventListener('scroll', this.repositionInZone);
        window.addEventListener('resize', this.repositionInZone);
        window.addEventListener('orientationchange', this.repositionInZone);
    };
    /**
     * @return {?}
     */
    AngularDropdownContentComponent.prototype.removeGlobalEvents = /**
     * @return {?}
     */
    function () {
        window.removeEventListener('scroll', this.repositionInZone);
        window.removeEventListener('resize', this.repositionInZone);
        window.removeEventListener('orientationchange', this.repositionInZone);
    };
    /**
     * @return {?}
     */
    AngularDropdownContentComponent.prototype.teardownEvents = /**
     * @return {?}
     */
    function () {
        this.removeGlobalEvents();
        this.stopObservingDomMutations();
        this.document.body.removeEventListener('mousedown', this.handleRootMouseDown, true);
        if (this.isTouchDevice) {
            this.document.body.removeEventListener('touchstart', this.touchStartHandler, true);
            this.document.body.removeEventListener('touchend', this.handleRootMouseDown, true);
        }
    };
    AngularDropdownContentComponent.decorators = [
        { type: Component, args: [{
                    selector: 'ng-dropdown-content,[ng-dropdown-content],[ngDropdownContent]',
                    template: "<ng-container *ngIf=\"dropdown.isOpen$ | async as isOpen\">\n  <ng-container *ngWormhole=\"'#ng-dropdown-outlet'; renderInPlace: dropdown.renderInPlace\">\n    <div *ngIf=\"overlay && isOpen\" class=\"ng-dropdown-overlay\"></div>\n    <div [id]=\"dropdown.dropdownId\"\n        class=\"ng-dropdown-content {{dropdownClass}}\"\n        [style.top]=\"(dropdown.position$ | async).top\"\n        [style.right]=\"(dropdown.position$ | async).right\"\n        [style.bottom]=\"(dropdown.position$ | async).bottom\"\n        [style.left]=\"(dropdown.position$ | async).left\"\n        [class.render-in-place]=\"dropdown.renderInPlace\"\n        [class.ng-dropdown-content--above]=\"(dropdown.position$ | async).vPosition === 'above'\"\n        [class.ng-dropdown-content--below]=\"(dropdown.position$ | async).vPosition === 'below'\"\n        [class.ng-dropdown-content--right]=\"(dropdown.position$ | async).hPosition === 'right'\"\n        [class.ng-dropdown-content--center]=\"(dropdown.position$ | async).hPosition === 'center'\"\n        [class.ng-dropdown-content--left]=\"(dropdown.position$ | async).hPosition === 'left'\">\n      <ng-content></ng-content>\n    </div>\n  </ng-container>\n  <div *ngIf=\"!isOpen\" [id]=\"dropdown.dropdownId\" class=\"ng-dropdown-placeholder\"></div>\n</ng-container>\n",
                    host: {
                        '[class.render-in-place]': 'dropdown.renderInPlace'
                    },
                    styles: [":host{display:none}:host.render-in-place{display:block;position:absolute}"]
                }] }
    ];
    AngularDropdownContentComponent.ctorParameters = function () { return [
        { type: AngularDropdownDirective, decorators: [{ type: Host }, { type: Inject, args: [forwardRef(function () { return AngularDropdownDirective; }),] }] },
        { type: NgZone },
        { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
    ]; };
    AngularDropdownContentComponent.propDecorators = {
        dropdownClass: [{ type: Input }],
        overlay: [{ type: Input }],
        transitioningInClass: [{ type: Input }],
        transitionedInClass: [{ type: Input }],
        transitioningOutClass: [{ type: Input }]
    };
    return AngularDropdownContentComponent;
}());
export { AngularDropdownContentComponent };
if (false) {
    /** @type {?} */
    AngularDropdownContentComponent.prototype.dropdownClass;
    /** @type {?} */
    AngularDropdownContentComponent.prototype.overlay;
    /** @type {?} */
    AngularDropdownContentComponent.prototype.hasMoved;
    /** @type {?} */
    AngularDropdownContentComponent.prototype._animationClass;
    /** @type {?} */
    AngularDropdownContentComponent.prototype.isTouchDevice;
    /** @type {?} */
    AngularDropdownContentComponent.prototype.mutationObserver;
    /** @type {?} */
    AngularDropdownContentComponent.prototype.destroy$;
    /** @type {?} */
    AngularDropdownContentComponent.prototype.transitioningInClass;
    /** @type {?} */
    AngularDropdownContentComponent.prototype.transitionedInClass;
    /** @type {?} */
    AngularDropdownContentComponent.prototype.transitioningOutClass;
    /** @type {?} */
    AngularDropdownContentComponent.prototype.shouldOpen;
    /** @type {?} */
    AngularDropdownContentComponent.prototype.document;
    /** @type {?} */
    AngularDropdownContentComponent.prototype.repositionInZone;
    /** @type {?} */
    AngularDropdownContentComponent.prototype.handleRootMouseDown;
    /** @type {?} */
    AngularDropdownContentComponent.prototype.touchStartHandler;
    /** @type {?} */
    AngularDropdownContentComponent.prototype.touchMoveHandler;
    /** @type {?} */
    AngularDropdownContentComponent.prototype.dropdown;
    /** @type {?} */
    AngularDropdownContentComponent.prototype.zone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhci1kcm9wZG93bi1jb250ZW50LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItZHJvcGRvd24vIiwic291cmNlcyI6WyJsaWIvYW5ndWxhci1kcm9wZG93bi1jb250ZW50LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFM0MsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBQ0wsSUFBSSxFQUNKLE1BQU0sRUFDTixVQUFVLEVBSVYsTUFBTSxFQUNQLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUUzQyxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUN4RSxPQUFPLEVBQUUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sU0FBUyxDQUFDOztJQUU5QyxnQkFBZ0IsR0FBRyxDQUFDLG1CQUFBLE1BQU0sRUFBTyxDQUFDLENBQUMsZ0JBQWdCO0FBRXpEO0lBb0NFLHlDQUdTLFFBQWtDLEVBQ2pDLElBQVksRUFDRixRQUFhO1FBTGpDLGlCQVFDO1FBTFEsYUFBUSxHQUFSLFFBQVEsQ0FBMEI7UUFDakMsU0FBSSxHQUFKLElBQUksQ0FBUTtRQTdCdEIsa0JBQWEsR0FBRyxFQUFFLENBQUM7UUFHbkIsWUFBTyxHQUFHLEtBQUssQ0FBQztRQUVSLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDakIsb0JBQWUsR0FBa0IsSUFBSSxDQUFDO1FBQ3RDLGtCQUFhLEdBQVksY0FBYyxJQUFJLE1BQU0sQ0FBQztRQUNsRCxxQkFBZ0IsR0FBNEIsSUFBSSxDQUFDO1FBQ2pELGFBQVEsR0FBRyxJQUFJLE9BQU8sRUFBUSxDQUFDO1FBR3ZDLHlCQUFvQixHQUFHLHVDQUF1QyxDQUFD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Ozs7Z0NBL0JqQixLQUFLOzBCQUdMLEtBQUs7dUNBU0wsS0FBSztzQ0FFTCxLQUFLO3dDQUVMLEtBQUs7O0lBdVBSLHNDQUFDO0NBQUEsQUFqUkQsSUFpUkM7U0F6UVksK0JBQStCOzs7SUFFMUMsd0RBQ21COztJQUVuQixrREFDZ0I7O0lBRWhCLG1EQUF5Qjs7SUFDekIsMERBQThDOztJQUM5Qyx3REFBMEQ7O0lBQzFELDJEQUF5RDs7SUFDekQsbURBQXVDOztJQUV2QywrREFDK0Q7O0lBQy9ELDhEQUM2RDs7SUFDN0QsZ0VBQ2lFOztJQU1qRSxxREFBMkI7O0lBQzNCLG1EQUEyQjs7SUF3RjNCLDJEQUNrRDs7SUFzQmxELDhEQTJCRTs7SUE4REYsNERBTUU7O0lBRUYsMkRBT0U7O0lBcE5BLG1EQUV5Qzs7SUFDekMsK0NBQW9CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQge1xuICBDb21wb25lbnQsXG4gIElucHV0LFxuICBIb3N0LFxuICBJbmplY3QsXG4gIGZvcndhcmRSZWYsXG4gIEFmdGVyVmlld0NoZWNrZWQsXG4gIE9uSW5pdCxcbiAgT25EZXN0cm95LFxuICBOZ1pvbmVcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IERPQ1VNRU5UIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcblxuaW1wb3J0IHsgQW5ndWxhckRyb3Bkb3duRGlyZWN0aXZlIH0gZnJvbSAnLi9hbmd1bGFyLWRyb3Bkb3duLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBjbG9zZXN0LCB3YWl0Rm9yQW5pbWF0aW9uIH0gZnJvbSAnLi91dGlscyc7XG5cbmNvbnN0IE11dGF0aW9uT2JzZXJ2ZXIgPSAod2luZG93IGFzIGFueSkuTXV0YXRpb25PYnNlcnZlcjtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmctZHJvcGRvd24tY29udGVudCxbbmctZHJvcGRvd24tY29udGVudF0sW25nRHJvcGRvd25Db250ZW50XScsXG4gIHRlbXBsYXRlVXJsOiAnLi9hbmd1bGFyLWRyb3Bkb3duLWNvbnRlbnQuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9hbmd1bGFyLWRyb3Bkb3duLWNvbnRlbnQuY29tcG9uZW50LmNzcyddLFxuICBob3N0OiB7XG4gICAgJ1tjbGFzcy5yZW5kZXItaW4tcGxhY2VdJzogJ2Ryb3Bkb3duLnJlbmRlckluUGxhY2UnXG4gIH1cbn0pXG5leHBvcnQgY2xhc3MgQW5ndWxhckRyb3Bkb3duQ29udGVudENvbXBvbmVudFxuICBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3Q2hlY2tlZCwgT25EZXN0cm95IHtcbiAgQElucHV0KClcbiAgZHJvcGRvd25DbGFzcyA9ICcnO1xuXG4gIEBJbnB1dCgpXG4gIG92ZXJsYXkgPSBmYWxzZTtcblxuICBwcml2YXRlIGhhc01vdmVkID0gZmFsc2U7XG4gIHByaXZhdGUgX2FuaW1hdGlvbkNsYXNzOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBpc1RvdWNoRGV2aWNlOiBib29sZWFuID0gJ29udG91Y2hzdGFydCcgaW4gd2luZG93O1xuICBwcml2YXRlIG11dGF0aW9uT2JzZXJ2ZXI6IE11dGF0aW9uT2JzZXJ2ZXIgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBkZXN0cm95JCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG5cbiAgQElucHV0KClcbiAgdHJhbnNpdGlvbmluZ0luQ2xhc3MgPSAnbmctZHJvcGRvd24tY29udGVudC0tdHJhbnNpdGlvbmluZy1pbic7XG4gIEBJbnB1dCgpXG4gIHRyYW5zaXRpb25lZEluQ2xhc3MgPSAnbmctZHJvcGRvd24tY29udGVudC0tdHJhbnNpdGlvbmVkLWluJztcbiAgQElucHV0KClcbiAgdHJhbnNpdGlvbmluZ091dENsYXNzID0gJ25nLWRyb3Bkb3duLWNvbnRlbnQtLXRyYW5zaXRpb25pbmctb3V0JztcblxuICBwcml2YXRlIGdldCBkcm9wZG93bkVsZW1lbnQoKTogSFRNTEVsZW1lbnQge1xuICAgIHJldHVybiB0aGlzLmRyb3Bkb3duLmRyb3Bkb3duRWxlbWVudDtcbiAgfVxuXG4gIHByaXZhdGUgc2hvdWxkT3BlbiA9IGZhbHNlO1xuICBwcml2YXRlIGRvY3VtZW50OiBEb2N1bWVudDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBASG9zdCgpXG4gICAgQEluamVjdChmb3J3YXJkUmVmKCgpID0+IEFuZ3VsYXJEcm9wZG93bkRpcmVjdGl2ZSkpXG4gICAgcHVibGljIGRyb3Bkb3duOiBBbmd1bGFyRHJvcGRvd25EaXJlY3RpdmUsXG4gICAgcHJpdmF0ZSB6b25lOiBOZ1pvbmUsXG4gICAgQEluamVjdChET0NVTUVOVCkgZG9jdW1lbnQ6IGFueVxuICApIHtcbiAgICB0aGlzLmRvY3VtZW50ID0gZG9jdW1lbnQ7XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmRyb3Bkb3duLm9uT3BlblxuICAgICAgLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveSQpKVxuICAgICAgLnN1YnNjcmliZSgoKSA9PiAodGhpcy5zaG91bGRPcGVuID0gdHJ1ZSkpO1xuXG4gICAgdGhpcy5kcm9wZG93bi5vbkNsb3NlXG4gICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpXG4gICAgICAuc3Vic2NyaWJlKCgpID0+IHRoaXMuY2xvc2UoKSk7XG4gIH1cblxuICBzZXQgYW5pbWF0aW9uQ2xhc3MoY2xhc3NOYW1lOiBzdHJpbmcgfCBudWxsKSB7XG4gICAgaWYgKHRoaXMuX2FuaW1hdGlvbkNsYXNzICYmIGNsYXNzTmFtZSAhPT0gdGhpcy5fYW5pbWF0aW9uQ2xhc3MpIHtcbiAgICAgIHRoaXMuZHJvcGRvd25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fYW5pbWF0aW9uQ2xhc3MpO1xuICAgIH0gZWxzZSBpZiAoY2xhc3NOYW1lKSB7XG4gICAgICB0aGlzLmRyb3Bkb3duRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7XG4gICAgfVxuICAgIHRoaXMuX2FuaW1hdGlvbkNsYXNzID0gY2xhc3NOYW1lO1xuICB9XG5cbiAgZ2V0IGFuaW1hdGlvbkNsYXNzKCk6IHN0cmluZyB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLl9hbmltYXRpb25DbGFzcztcbiAgfVxuXG4gIGdldCB0cmlnZ2VyRWxlbWVudCgpOiBFbGVtZW50IHtcbiAgICByZXR1cm4gdGhpcy5kcm9wZG93bi50cmlnZ2VyRWxlbWVudDtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpIHtcbiAgICBpZiAodGhpcy5zaG91bGRPcGVuKSB7XG4gICAgICB0aGlzLmFuaW1hdGlvbkNsYXNzID0gdGhpcy50cmFuc2l0aW9uaW5nSW5DbGFzcztcbiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLm9wZW4oKSk7XG4gICAgICB0aGlzLnNob3VsZE9wZW4gPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLmRlc3Ryb3kkLm5leHQoKTtcbiAgICB0aGlzLnRlYXJkb3duRXZlbnRzKCk7XG4gIH1cblxuICBvcGVuKCk6IHZvaWQge1xuICAgIHRoaXMuZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgJ21vdXNlZG93bicsXG4gICAgICB0aGlzLmhhbmRsZVJvb3RNb3VzZURvd24sXG4gICAgICB0cnVlXG4gICAgKTtcblxuICAgIGlmICh0aGlzLmlzVG91Y2hEZXZpY2UpIHtcbiAgICAgIHRoaXMuZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgICAndG91Y2hzdGFydCcsXG4gICAgICAgIHRoaXMudG91Y2hTdGFydEhhbmRsZXIsXG4gICAgICAgIHRydWVcbiAgICAgICk7XG4gICAgICB0aGlzLmRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgJ3RvdWNoZW5kJyxcbiAgICAgICAgdGhpcy5oYW5kbGVSb290TW91c2VEb3duLFxuICAgICAgICB0cnVlXG4gICAgICApO1xuICAgIH1cblxuICAgIGxldCBjaGFuZ2VzID0gdGhpcy5kcm9wZG93bi5yZXBvc2l0aW9uKCk7XG4gICAgaWYgKCF0aGlzLmRyb3Bkb3duLnJlbmRlckluUGxhY2UpIHtcbiAgICAgIHRoaXMuYWRkR2xvYmFsRXZlbnRzKCk7XG4gICAgICB0aGlzLnN0YXJ0T2JzZXJ2aW5nRG9tTXV0YXRpb25zKCk7XG4gICAgfSBlbHNlIGlmIChjaGFuZ2VzICE9PSBudWxsICYmIGNoYW5nZXMudlBvc2l0aW9uID09PSAnYWJvdmUnKSB7XG4gICAgICB0aGlzLnN0YXJ0T2JzZXJ2aW5nRG9tTXV0YXRpb25zKCk7XG4gICAgfVxuXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMuYW5pbWF0ZUluKCkpO1xuICB9XG5cbiAgY2xvc2UoKTogdm9pZCB7XG4gICAgdGhpcy50ZWFyZG93bkV2ZW50cygpO1xuICAgIHRoaXMuYW5pbWF0ZU91dCgpO1xuICB9XG5cbiAgcHJpdmF0ZSByZXBvc2l0aW9uSW5ab25lID0gKCkgPT5cbiAgICB0aGlzLnpvbmUucnVuKCgpID0+IHRoaXMuZHJvcGRvd24ucmVwb3NpdGlvbigpKTtcblxuICBwcml2YXRlIGFuaW1hdGVJbigpOiB2b2lkIHtcbiAgICB3YWl0Rm9yQW5pbWF0aW9uKHRoaXMuZHJvcGRvd25FbGVtZW50LCAoKSA9PiB7XG4gICAgICB0aGlzLmFuaW1hdGlvbkNsYXNzID0gdGhpcy50cmFuc2l0aW9uZWRJbkNsYXNzO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBhbmltYXRlT3V0KCk6IHZvaWQge1xuICAgIGxldCBwYXJlbnRFbGVtZW50ID0gdGhpcy5kcm9wZG93bi5yZW5kZXJJblBsYWNlXG4gICAgICA/IHRoaXMuZHJvcGRvd25FbGVtZW50LnBhcmVudEVsZW1lbnQhLnBhcmVudEVsZW1lbnRcbiAgICAgIDogdGhpcy5kcm9wZG93bkVsZW1lbnQucGFyZW50RWxlbWVudDtcbiAgICBsZXQgY2xvbmUgPSB0aGlzLmRyb3Bkb3duRWxlbWVudC5jbG9uZU5vZGUodHJ1ZSkgYXMgSFRNTEVsZW1lbnQ7XG4gICAgY2xvbmUuaWQgPSBgJHt0aGlzLmRyb3Bkb3duRWxlbWVudC5pZH0tLWNsb25lYDtcbiAgICBjbG9uZS5jbGFzc0xpc3QucmVtb3ZlKHRoaXMudHJhbnNpdGlvbmVkSW5DbGFzcyk7XG4gICAgY2xvbmUuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLnRyYW5zaXRpb25pbmdJbkNsYXNzKTtcbiAgICBjbG9uZS5jbGFzc0xpc3QuYWRkKHRoaXMudHJhbnNpdGlvbmluZ091dENsYXNzKTtcbiAgICBwYXJlbnRFbGVtZW50IS5hcHBlbmRDaGlsZChjbG9uZSk7XG4gICAgdGhpcy5hbmltYXRpb25DbGFzcyA9IHRoaXMudHJhbnNpdGlvbmluZ0luQ2xhc3M7XG4gICAgd2FpdEZvckFuaW1hdGlvbihjbG9uZSwgKCkgPT4gcGFyZW50RWxlbWVudCEucmVtb3ZlQ2hpbGQoY2xvbmUpKTtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlUm9vdE1vdXNlRG93biA9IChlOiBFdmVudCk6IHZvaWQgPT4ge1xuICAgIGlmIChcbiAgICAgIHRoaXMuaGFzTW92ZWQgfHxcbiAgICAgIHRoaXMuZHJvcGRvd25FbGVtZW50LmNvbnRhaW5zKGUudGFyZ2V0IGFzIEVsZW1lbnQpIHx8XG4gICAgICAodGhpcy50cmlnZ2VyRWxlbWVudCAmJlxuICAgICAgICB0aGlzLnRyaWdnZXJFbGVtZW50LmNvbnRhaW5zKGUudGFyZ2V0IGFzIEVsZW1lbnQpKVxuICAgICkge1xuICAgICAgdGhpcy5oYXNNb3ZlZCA9IGZhbHNlO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxldCBjbG9zZXN0RHJvcGRvd24gPSBjbG9zZXN0KGUudGFyZ2V0IGFzIEVsZW1lbnQsICduZy1kcm9wZG93bi1jb250ZW50Jyk7XG4gICAgaWYgKGNsb3Nlc3REcm9wZG93bikge1xuICAgICAgbGV0IHRyaWdnZXIgPSB0aGlzLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgIGBbYXJpYS1jb250cm9scz0ke2Nsb3Nlc3REcm9wZG93bi5nZXRBdHRyaWJ1dGUoJ2lkJyl9XWBcbiAgICAgICk7XG4gICAgICBsZXQgcGFyZW50RHJvcGRvd24gPSBjbG9zZXN0KHRyaWdnZXIhLCAnbmctZHJvcGRvd24tY29udGVudCcpO1xuICAgICAgaWYgKFxuICAgICAgICBwYXJlbnREcm9wZG93biAmJlxuICAgICAgICBwYXJlbnREcm9wZG93bi5nZXRBdHRyaWJ1dGUoJ2lkJykgPT09IHRoaXMuZHJvcGRvd24uZHJvcGRvd25JZFxuICAgICAgKSB7XG4gICAgICAgIHRoaXMuaGFzTW92ZWQgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuZHJvcGRvd24uY2xvc2UodHJ1ZSk7XG4gIH07XG5cbiAgcHJpdmF0ZSBzdGFydE9ic2VydmluZ0RvbU11dGF0aW9ucygpOiB2b2lkIHtcbiAgICBpZiAoTXV0YXRpb25PYnNlcnZlcikge1xuICAgICAgdGhpcy5tdXRhdGlvbk9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKG11dGF0aW9uczogYW55KSA9PiB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBtdXRhdGlvbnNbMF0uYWRkZWROb2Rlcy5sZW5ndGggfHxcbiAgICAgICAgICBtdXRhdGlvbnNbMF0ucmVtb3ZlZE5vZGVzLmxlbmd0aFxuICAgICAgICApIHtcbiAgICAgICAgICB0aGlzLnJlcG9zaXRpb25JblpvbmUoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLm11dGF0aW9uT2JzZXJ2ZXIhLm9ic2VydmUodGhpcy5kcm9wZG93bkVsZW1lbnQsIHtcbiAgICAgICAgY2hpbGRMaXN0OiB0cnVlLFxuICAgICAgICBzdWJ0cmVlOiB0cnVlXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5kcm9wZG93bkVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgJ0RPTU5vZGVJbnNlcnRlZCcsXG4gICAgICAgIHRoaXMucmVwb3NpdGlvbkluWm9uZSxcbiAgICAgICAgZmFsc2VcbiAgICAgICk7XG4gICAgICB0aGlzLmRyb3Bkb3duRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgICAnRE9NTm9kZVJlbW92ZWQnLFxuICAgICAgICB0aGlzLnJlcG9zaXRpb25JblpvbmUsXG4gICAgICAgIGZhbHNlXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc3RvcE9ic2VydmluZ0RvbU11dGF0aW9ucygpOiB2b2lkIHtcbiAgICBpZiAoTXV0YXRpb25PYnNlcnZlcikge1xuICAgICAgaWYgKHRoaXMubXV0YXRpb25PYnNlcnZlcikge1xuICAgICAgICB0aGlzLm11dGF0aW9uT2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICAgICAgICB0aGlzLm11dGF0aW9uT2JzZXJ2ZXIgPSBudWxsO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGhpcy5kcm9wZG93bkVsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5kcm9wZG93bkVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgICAnRE9NTm9kZUluc2VydGVkJyxcbiAgICAgICAgICB0aGlzLnJlcG9zaXRpb25JblpvbmVcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5kcm9wZG93bkVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgICAnRE9NTm9kZVJlbW92ZWQnLFxuICAgICAgICAgIHRoaXMucmVwb3NpdGlvbkluWm9uZVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYWRkR2xvYmFsRXZlbnRzKCk6IHZvaWQge1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLnJlcG9zaXRpb25JblpvbmUpO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLnJlcG9zaXRpb25JblpvbmUpO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvcmllbnRhdGlvbmNoYW5nZScsIHRoaXMucmVwb3NpdGlvbkluWm9uZSk7XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZUdsb2JhbEV2ZW50cygpOiB2b2lkIHtcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgdGhpcy5yZXBvc2l0aW9uSW5ab25lKTtcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5yZXBvc2l0aW9uSW5ab25lKTtcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignb3JpZW50YXRpb25jaGFuZ2UnLCB0aGlzLnJlcG9zaXRpb25JblpvbmUpO1xuICB9XG5cbiAgcHJpdmF0ZSB0b3VjaFN0YXJ0SGFuZGxlciA9IChlOiBFdmVudCkgPT4ge1xuICAgIHRoaXMuZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgJ3RvdWNobW92ZScsXG4gICAgICB0aGlzLnRvdWNoTW92ZUhhbmRsZXIsXG4gICAgICB0cnVlXG4gICAgKTtcbiAgfTtcblxuICBwcml2YXRlIHRvdWNoTW92ZUhhbmRsZXIgPSAoZTogRXZlbnQpID0+IHtcbiAgICB0aGlzLmhhc01vdmVkID0gdHJ1ZTtcbiAgICB0aGlzLmRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcihcbiAgICAgICd0b3VjaG1vdmUnLFxuICAgICAgdGhpcy50b3VjaE1vdmVIYW5kbGVyLFxuICAgICAgdHJ1ZVxuICAgICk7XG4gIH07XG5cbiAgcHJpdmF0ZSB0ZWFyZG93bkV2ZW50cygpIHtcbiAgICB0aGlzLnJlbW92ZUdsb2JhbEV2ZW50cygpO1xuICAgIHRoaXMuc3RvcE9ic2VydmluZ0RvbU11dGF0aW9ucygpO1xuICAgIHRoaXMuZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFxuICAgICAgJ21vdXNlZG93bicsXG4gICAgICB0aGlzLmhhbmRsZVJvb3RNb3VzZURvd24sXG4gICAgICB0cnVlXG4gICAgKTtcblxuICAgIGlmICh0aGlzLmlzVG91Y2hEZXZpY2UpIHtcbiAgICAgIHRoaXMuZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKFxuICAgICAgICAndG91Y2hzdGFydCcsXG4gICAgICAgIHRoaXMudG91Y2hTdGFydEhhbmRsZXIsXG4gICAgICAgIHRydWVcbiAgICAgICk7XG4gICAgICB0aGlzLmRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgJ3RvdWNoZW5kJyxcbiAgICAgICAgdGhpcy5oYW5kbGVSb290TW91c2VEb3duLFxuICAgICAgICB0cnVlXG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuIl19